R course Part 3 - Pseudo Facebook
========================================================

In part 3 of our pseudofacebook dataset analysis we will explore more than 2 variables at a time.

```{r Load Data}
# Check current path
path <- getwd()

# Set path to dataset
path <- setwd('~/github/DataAnalyst/Rbasics_Appendix/pseudoFacebookAnalysis/')

file <- 'pseudo_facebook.tsv'

pf <- read.csv(file, sep = '\t')

# load ggplot
library(ggplot2)

```

### Third Qualitative Variable

Let's start exploring our age distributions by gender, we can create a boxplot for each gender. We can identify the mean in the box plot using ```stat_summary(fun.y=mean, geom = 'point', shape=4)```, where the shape being 4 is the x symbol, and the geom = point marks the mean only as a point.

Another graph we can do is the age and gender count using the median as the measure of center.

```{r Third Qualitative Variable}
# Age by gender boxplots
ggplot(aes(x = gender, y = age),
       data = subset(pf, !is.na(gender))) + 
  geom_boxplot() +
  stat_summary(fun.y = mean, geom = 'point', shape = 4)

# graph of friend count by gender
ggplot(aes(x = age, y = friend_count),
       data = subset(pf, !is.na(gender))) +
  geom_line(aes(color = gender), stat = 'summary', fun.y = median)
```

Let's now create a dataframe that groups our users by age and gender to obtain the mean of friend count, median of friend count and members of each group.

```{r}
library(dplyr)

# filter instead of using subset inside group_by()
pf_filter_gender <- filter(pf,!is.na(gender))

# group by age and gender
age_gender_group <- group_by(pf_filter_gender, age, gender)

# summarise the data in a dataframe
pf.fc_by_age_gender <- summarise(age_gender_group,
                                 mean_friend_count = mean(friend_count),
                                 median_friend_count = median(friend_count),
                                 n = n())

# removes grouping (when using group_by 2 or more variables, operations will be constrained to groups, we need to remove this constrain)
pf.fc_by_age_gender <- ungroup(pf.fc_by_age_gender)

pf.fc_by_age_gender <- arrange(pf.fc_by_age_gender,age)

head(pf.fc_by_age_gender, 10)
```

An alternative way to obtain the same dataframe is using ```%>%```

```{r}

pf.fc_by_age_gender <- pf %>%
                        filter(!is.na(gender)) %>%
                        group_by(age, gender) %>%
                        summarise(mean_friend_count = mean(friend_count),
                                  median_friend_count = median(friend_count),
                                  n = n()) %>%
                        ungroup() %>%
                        arrange(age)
        

head(pf.fc_by_age_gender, 10)

```


***

### Plotting Conditional Summaries

After we consolidated our dataframe we can use it to plot the median of friend count per gender and age.

```{r Plotting Conditional Summaries}
ggplot(aes(x = age, y = median_friend_count), data = pf.fc_by_age_gender) +
  geom_line(aes(color = gender) )
```

***

### Thinking in Ratios
From the plot above we can notice that the women of ages younger than 30 have almost 2.5 times more friends then men at that ages. We can also see that women have more friens in general until late ages if we can consider them because the data after 70 seems suspicious.

***

### Wide and Long Format
The data we have is in a long format or more tidy as it has one column that englobes catgeories to make it more tidy and have a record per data. However, for some of our analysis we want to change from this long format to wide format to be able to interpret categorical values of one column into different columns (similar to dummy variables, but these are columns split for comparing our variables/categories). 

In this case, we want to compare gender, so we will need to have instead of one column for gender, two columns: one for male and another for female.

***

### Reshaping Data
Let's reshape median_friend_count data so that the gender is split in a wide view of the data, meaning that gender column will be left out and we will have columns female and male. We can do this using ```reshape2``` library and its method ```dcast()```. 

An important note for the usage of ```dcast()``` is when we specify the variables we want to keep or split. We use a syntax similar to the following one:

Columns to keep as their are go on the left of a ```~```
Columns that we want to split in separate columns per variables on it go on the right of ```~```


Thus, below you see ```age ~ gender``` since we want the age groups to stay in a column, but we want the gender column to split into its two values: male and female. then, we will use ```value.var``` to determine the data to use to populate the rows of each column after the split.

```{r}
install.packages('reshape2')
library(reshape2)

pf.fc_by_age_gender.wide <- dcast(pf.fc_by_age_gender,
                                  age ~ gender,
                                  value.var = 'median_friend_count')

head( pf.fc_by_age_gender.wide,10)
```

Analternative way of reshaping our data is by using ```tidyr```:

```
pf.fc_by_age_gender.wide <-
  subset(pf.fc_by_age_gender[c('age', 'gender', 'median_friend_count')],
         !is.na(gender)) %>%
  spread(gender, median_friend_count) %>%
  mutate(ratio = male / female)

head(pf.fc_by_age_gender.wide)
```


***

### Ratio Plot
Once we have our wide dataframe for age of female and male median friend count, let's look at a plot of their ratios.

```{r Ratio Plot}
ggplot(aes(x = age, y = female/male), data = pf.fc_by_age_gender.wide) +
  geom_line() +
  geom_hline(yintercept = 1, alpha = 0.4, linetype = 2)
```

From this plot we can confirm our assumption that young women usually have 2.5 more friends than male at the same age. This also show us that women tend to have more friends on facebook.

***

### Third Quantitative Variable
Notes:

```{r Third Quantitative Variable}

```

***

### Cut a Variable
Notes:

```{r Cut a Variable}

```

***

### Plotting it All Together
Notes:

```{r Plotting it All Together}

```

***

### Plot the Grand Mean
Notes:

```{r Plot the Grand Mean}

```

***

### Friending Rate
Notes:

```{r Friending Rate}

```

***

### Friendships Initiated
Notes:

What is the median friend rate?

What is the maximum friend rate?

```{r Friendships Initiated}

```

***

### Bias-Variance Tradeoff Revisited
Notes:

```{r Bias-Variance Tradeoff Revisited}

ggplot(aes(x = tenure, y = friendships_initiated / tenure),
       data = subset(pf, tenure >= 1)) +
  geom_line(aes(color = year_joined.bucket),
            stat = 'summary',
            fun.y = mean)

ggplot(aes(x = 7 * round(tenure / 7), y = friendships_initiated / tenure),
       data = subset(pf, tenure > 0)) +
  geom_line(aes(color = year_joined.bucket),
            stat = "summary",
            fun.y = mean)

ggplot(aes(x = 30 * round(tenure / 30), y = friendships_initiated / tenure),
       data = subset(pf, tenure > 0)) +
  geom_line(aes(color = year_joined.bucket),
            stat = "summary",
            fun.y = mean)

ggplot(aes(x = 90 * round(tenure / 90), y = friendships_initiated / tenure),
       data = subset(pf, tenure > 0)) +
  geom_line(aes(color = year_joined.bucket),
            stat = "summary",
            fun.y = mean)

```

***

### Sean's NFL Fan Sentiment Study
Notes:

***

### Introducing the Yogurt Data Set
Notes:

***

### Histograms Revisited
Notes:

```{r Histograms Revisited}

```

***

### Number of Purchases
Notes:

```{r Number of Purchases}

```

***

### Prices over Time
Notes:

```{r Prices over Time}

```

***

### Sampling Observations
Notes:

***

### Looking at Samples of Households

```{r Looking at Sample of Households}

```

***

### The Limits of Cross Sectional Data
Notes:

***

### Many Variables
Notes:

***

### Scatterplot Matrix
Notes:

***

### Even More Variables
Notes:

***

### Heat Maps
Notes:

```{r}
nci <- read.table("nci.tsv")
colnames(nci) <- c(1:64)
```

```{r}
nci.long.samp <- melt(as.matrix(nci[1:200,]))
names(nci.long.samp) <- c("gene", "case", "value")
head(nci.long.samp)

ggplot(aes(y = gene, x = case, fill = value),
  data = nci.long.samp) +
  geom_tile() +
  scale_fill_gradientn(colours = colorRampPalette(c("blue", "red"))(100))
```


***

### Analyzing Three of More Variables
Reflection:

***

Click **KnitHTML** to see all of your hard work and to have an html
page of this lesson, your answers, and your notes!

