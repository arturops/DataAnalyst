R course Lesson 4 - Pseudo Facebook
========================================================

We will continue the effort of understanding the audience perceived. In the previous analysis we understood our data and found that women tend to have more likes and friends compared to men. However, men initiate more friendships. In this exercise, we dive into the audience analysis.

### Scatterplots and Perceived Audience Size

We can start using scatter plots to compare relations on two variables data.
We will review the age and number of friends.


```{r Scatterplots}
library(ggplot2)

# Check current path
path <- getwd()

# Set path to dataset
path <- setwd('~/github/DataAnalyst/Rbasics_Appendix/pseudoFacebookAnalysis/')

file <- 'pseudo_facebook.tsv'

pf <- read.csv(file, sep = '\t')

qplot(x = age, y = friend_count, data = pf)

```

We can tell that young people have more friends and that most likely the people over 60 who has a lot of friends might be people who fake their age. Based on our observation, this people who faked their age might be teengers as that part of our sample has a similar number count of friend.

**Note:** Another way to plot data using ```ggplot``` is:
```{r ggplot Syntax}
ggplot(aes(x = age, y = friend_count), data = pf) +
  geom_point() +
  xlim(13,90) # clips the plot from 13 to 90
```
We clipped the plot above from 13 to 90 years old based on our observations of the first plot with ```qplot```
***

### Overplotting
Our previous graph was overplotted, meaning that point overlap to each other making it difficult for us to see it. We can use the ```alpha``` parameter inside ```geom_point()``` to make points clearer and the more that get stack over each other the stronger the color. 

```{r Overplotting}
ggplot(aes(x = age, y = friend_count), data = pf) +
  geom_point(alpha = 1/20) +
  xlim(13,90)
```

#### What do you notice in the plot?
We can tell righ away that the darker part of the plot lives on the bottom, which means that most of our data is below 1000 friend counts. This matches our first observation, but now it is very clear to see it.


We can also use ```geom_jitter()``` instead of ```geom_point()``` to find trends easily and how the data disperses.

```{r jitter}
ggplot(aes(x = age, y = friend_count), data = pf) +
  geom_jitter(alpha = 1/20) +
  xlim(13,90)
```
***

Something we noticed in this new plot is how the data diffuses from condensed mass to less points. This also can help to see trends.

### Coord_trans()
We might want to understand our data better, and for that we can apply a transform to ages (x axis) and separate for friend_count (y axis). In this case we will do a square root transformation to it. This can be achieved using ```coord_trans()```.

We will first do this using ```geom_point()``` and then we will use the parameter ```position``` to set a jitter. To avoid warnings caused by ```xlim``` we use ```coord_cartesian``` to clip the x axis without eliminating all our data outside the clip.

First let's do it for age
```{r Coord_trans()}
ggplot(aes(x = age, y = friend_count), data = pf) +
  geom_point(alpha = 1/20) +
  coord_trans(x = 'sqrt') +
  coord_cartesian(xlim = c(13,90))
```

Then, let's try it for friend_count

```{r Coord_trans()}
ggplot(aes(x = age, y = friend_count), data = pf) +
  geom_point(alpha = 1/20) +
  coord_cartesian(xlim = c(13,90)) +
  coord_trans(y = 'sqrt')
```

Now, let's add jitter to age using ```position = position_jitter(h = 0)```. This syntax prevent us to use negative values from age (if any), this way we do not calculate values that make no sense for our friends count.

```{r jitter coord_trans()}
ggplot(aes(x = age, y = friend_count), data = pf) +
  geom_point(alpha = 1/20, position = position_jitter(h = 0)) +
  coord_trans(x = 'sqrt') +
  coord_cartesian(xlim = c(13,90)) 

ggplot(aes(x = age, y = friend_count), data = pf) +
  geom_point(alpha = 1/20, position = position_jitter(h = 0)) +
  coord_cartesian(xlim = c(13,90)) +
  coord_trans(y = 'sqrt')
```

**Note:** There is another way to set an axis scale to be ```sqrt``` and we can do it using ```scale_x_sqrt()``` and ```scale_y_sqrt()``` as follow:

```
ggplot(aes(x = age, y = friend_count), data = pf) +
  geom_point(alpha = 1/20) +
  coord_cartesian(xlim = c(13,90)) +
  scale_x_sqrt() +
  scale_y_sqrt()
```

#### What do you notice?

After transforming the data we noticed that:

* x axis transformation shows almost no difference from what we had before, so the dsitribution doesn't change much.

* y axis transformation shows our data shifting up for older ages. This actually helps to refine what we believed about our data. Meaning that we can now know that from older ages there are almost no people with less than 50 friends.

### Alpha and Jitter

As additional practice, we will examine the relationship between friendships_initiated (y) and age (x) using the ggplot.

```{r Alpha and Jitter}
ggplot(aes(x = age, y = friendships_initiated), data = pf) +
  geom_jitter(alpha = 1/10)
```

We noticed that the plot shows people over 90 years old initiated a lot of friendships, that seems odd. Also around 70 years old we have this behavior. It might be a good idea to apply a transformation to our friendship initiated data and see if we find a pattern. 

```{r second friendships_initiated}
ggplot(aes(x = age, y = friendships_initiated ), data = pf) +
  geom_point(alpha = 1/20, position = position_jitter(h = 0)) +
  coord_trans( y = 'sqrt')
```

Once we did the transformation, we can see the high density areas that correspond to the most common counts of friendships started for a specific age group.

***

### Conditional Means
If we need to analyze datasets, R has a package named ```dplyr``` which allow us to do more with our dataset.

Let's try to use the friend count data and group it by age. Then, let's make a table of groups and their mean and median.

```{r Conditional Means}
#install.packages('dplyr')
library(dplyr)

# group by age
age_groups <- group_by(pf, age)

# create table of age groups, number of elements (n()), mean, and median
pf.fc_by_age <- summarise(age_groups,
                          friend_count_mean = mean(friend_count),
                          friend_count_median = median(friend_count),
                          n = n())

# arrange summary by age
pf.fc_by_age <- arrange(pf.fc_by_age, age)

# show 10 elements from head
head(pf.fc_by_age, 10)

```

We can also use a different notation to do the previous analysis. This will be similar to cascading command one another (similar to pipes in linux command line), for this we use the symbol ```%.%``` or in newest versions of dplyr ```%>%```.

```{r Conditional Means Alternative}

pf.fc_by_age <- pf %>%
                  group_by(age) %>%
                  summarise(friend_count_mean = mean(friend_count),
                            friend_count_median = median(friend_count),
                            n = n()) %>%
                                    arrange(age)

head(pf.fc_by_age,10)

```

We can see that the summary group the friend counts by age, obtained the mean, meadian and then sorted by age from smaller to greater. This is very helpful when we analyze data and want to find trends over the year or on a more organized manner.

Once we have our summary data, we would like to analyze it, but looking at the table might be a bit tedious. Let's create a plot to look at our summary for the mean of friend count!

```{r Conditional Means Plot}
ggplot(aes(y = friend_count_mean, x = age), data = pf.fc_by_age) +
  geom_line()
```

We could have used the scatter plot, but it is easier to see our trends using ```geom_line``` as it is connecting our points and displaying variations.

We can tell from the plot that what we believe was right, the ages over 90, around 70, and below 20 have a spike in the friends count mean. This indicates these ages have the most friends on average.

***

### Overlaying Summaries with Raw Data
Before we had created a scatter plot on all the data of friend counts per age and another plot of the mean of such data. Let's combine both plots and at the same time let's add the 10% quantile, the 90% quantile and the median. We can do all of this using the functions ```geom_point``` and ```geom_line```.

```{r Overlaying Summaries with Raw Data}
ggplot(aes(x = age, y = friend_count), data = pf) +
  geom_point(alpha = 1/20, 
             position = position_jitter(h = 0),
             color = 'orange') +
  coord_trans(y = 'sqrt') +
  geom_line(stat = 'summary', fun.y = mean) +
  geom_line(stat = 'summary', fun.y = quantile, fun.args = list(probs = 0.1),
            linetype = 2, color = 'blue') +
  geom_line(stat = 'summary', fun.y = median,
            color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, fun.args = list (probs = 0.9),
            linetype = 2, color = 'blue')
  
```

#### What are some of your observations of the plot?
 We can see that the median is very close to our mean and they follow the same trend. This confirms some of our assumptions if we were to use the median.
 Also, the 10% quantile shows that the older people get the more friends the have, while the 90% quantile clearly show the highest peaks as dominant. This also means that having more than 1000 friends is very rare.
 
 We can zoom in to our graph using ```coord_cartesian(xlim = c(a,b), ylim =c(a,b))``` where ```a``` means lower bound and ```b``` upper bound.

```{r Zoom in Summaries Plots}
ggplot(aes(x = age, y = friend_count), data = pf) +
  geom_point(alpha = 1/20, position = position_jitter(h=0),
             color = 'orange') +
  coord_trans(y = 'sqrt') +
  geom_line(stat = 'summary', fun.y = mean) +
  geom_line(stat = 'summary', fun.y = quantile, fun.args = list(probs = 0.1),
            linetype = 2, color = 'blue') +
  geom_line(stat = 'summary', fun.y = median, color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, fun.args = list(probs = 0.9),
            linetype = 2, color = 'blue') +
  coord_cartesian(xlim = c(13,70), ylim = c(0,1000))
```

Now that we zoomed in, we can see that on average people from ages between 20 and 60 years old have less than 200 friends.

***

### Moira: Histogram Summary and Scatterplot
See the Instructor Notes of this video to download Moira's paper on perceived audience size and to see the final plot.

Notes:

***

### Correlation
Notes:

```{r Correlation}

```

Look up the documentation for the cor.test function.

What's the correlation between age and friend count? Round to three decimal places.
Response:

***

### Correlation on Subsets
Notes:

```{r Correlation on Subsets}
with(                 , cor.test(age, friend_count))
```

***

### Correlation Methods
Notes:

***

## Create Scatterplots
Notes:

```{r}

```

***

### Strong Correlations
Notes:

```{r Strong Correlations}

```

What's the correlation betwen the two variables? Include the top 5% of values for the variable in the calculation and round to 3 decimal places.

```{r Correlation Calcuation}

```

Response:

***

### Moira on Correlation
Notes:

***

### More Caution with Correlation
Notes:

```{r More Caution With Correlation}
install.packages('alr3')
library(alr3)
```

Create your plot!

```{r Temp vs Month}

```

***

### Noisy Scatterplots
a. Take a guess for the correlation coefficient for the scatterplot.

b. What is the actual correlation of the two variables?
(Round to the thousandths place)

```{r Noisy Scatterplots}

```

***

### Making Sense of Data
Notes:

```{r Making Sense of Data}

```

***

### A New Perspective

What do you notice?
Response:

Watch the solution video and check out the Instructor Notes!
Notes:

***

### Understanding Noise: Age to Age Months
Notes:

```{r Understanding Noise: Age to Age Months}

```

***

### Age with Months Means

```{r Age with Months Means}

```

Programming Assignment
```{r Programming Assignment}

```

***

### Noise in Conditional Means

```{r Noise in Conditional Means}

```

***

### Smoothing Conditional Means
Notes:

```{r Smoothing Conditional Means}

```

***

### Which Plot to Choose?
Notes:

***

### Analyzing Two Variables
Reflection:

***

Click **KnitHTML** to see all of your hard work and to have an html
page of this lesson, your answers, and your notes!

